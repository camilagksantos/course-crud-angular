<mat-card>
    <!--Course Details Header-->
    <mat-card-header>
        <mat-toolbar>Detalhes do Curso</mat-toolbar>
    </mat-card-header>

    <mat-card-content>
        <form [formGroup]="form" class="min-width">

            <!--Name Field-->
            <mat-form-field class="full-width">
                <mat-label>Nome</mat-label>
                <input matInput formControlName="name">
                <mat-hint align="end">{{form.get('name')?.value?.length || 0}}/100</mat-hint>

                @if (form.get('name')?.hasError('required')) {
                <mat-error>Nome é obrigatório</mat-error>
                }
                @if (form.get('name')?.hasError('minlength')) {
                <mat-error>Nome deve ter pelo menos 5 caracteres</mat-error>
                }
                @if (form.get('name')?.hasError('maxlength')) {
                <mat-error>Nome não pode passar de 100 caracteres</mat-error>
                }
            </mat-form-field>

            <!--Category Field-->
            <mat-form-field class="full-width">
                <mat-label>Categoria</mat-label>
                <mat-select formControlName="category">
                    <mat-option *ngFor="let category of categories" [value]="category.value">
                        {{category.viewValue}}
                    </mat-option>
                </mat-select>

                @if (form.get('category')?.hasError('required')) {
                <mat-error>Categoria é obrigatória</mat-error>
                }
            </mat-form-field>

            <!--Lessons Section-->
            <div class="lessons-section">
                <!--Lessons Header-->
                <mat-toolbar class="lessons-toolbar">
                    <span>Aulas</span>
                    <button mat-icon-button class="btn-add" (click)="addNewLesson()" type="button">
                        <mat-icon>add</mat-icon>
                    </button>
                </mat-toolbar>

                <!--Message when no lessons exist-->
                <div *ngIf="lessonsFormArray.length === 0" class="no-lessons-message">
                    <mat-icon>school</mat-icon>
                    <p>Sem aulas até o momento!</p>
                    <p class="subtitle">Clique no botão + para adicionar a primeira aula.</p>
                </div>

                <!--Lessons Form Container-->
                <div *ngIf="lessonsFormArray.length > 0" formArrayName="lessons" class="lessons-container">
                    <!--Individual Lesson Row-->
                    <div *ngFor="let lesson of lessonsFormArray.controls; let index = index" [formGroupName]="index"
                        class="lesson-row">

                        <!--Lesson Form Fields-->
                        <div class="lesson-fields">
                            <!--Lesson Name Field-->
                            <mat-form-field class="lesson-name-field">
                                <mat-label>Aula</mat-label>
                                <input matInput formControlName="name">
                                @if (lesson.get('name')?.hasError('required')) {
                                <mat-error>Aula é obrigatória</mat-error>
                                }
                            </mat-form-field>

                            <!--YouTube URL Field-->
                            <mat-form-field class="lesson-url-field">
                                <mat-label>URL</mat-label>
                                <span matPrefix>http://youtube.be/</span>
                                <input matInput formControlName="youtubeUrl">
                                <mat-hint align="end">{{lesson.get('youtubeUrl')?.value?.length || 0}}/11</mat-hint>
                                @if (lesson.get('youtubeUrl')?.hasError('required')) {
                                <mat-error>URL é obrigatória</mat-error>
                                }
                                @if (lesson.get('youtubeUrl')?.hasError('minlength')) {
                                <mat-error>URL deve ter exatamente 11 caracteres</mat-error>
                                }
                                @if (lesson.get('youtubeUrl')?.hasError('maxlength')) {
                                <mat-error>URL deve ter exatamente 11 caracteres</mat-error>
                                }
                            </mat-form-field>
                        </div>

                        <!--Remove Lesson Button-->
                        <button mat-icon-button class="btn-remove" (click)="removeLesson(index)" type="button"
                            matTooltip="Remover aula">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </div>
                </div>
            </div>

        </form>
    </mat-card-content>

    <!--Actions Section-->
    <mat-card-actions>
        <button mat-raised-button class="btn-save" (click)="onSubmit()">Salvar</button>
        <button mat-raised-button class="btn-cancel" (click)="onCancel()">Cancelar</button>
    </mat-card-actions>
</mat-card>